version: '2'
services:
  vpn:
    build:
      context: ./openvpn
      args:
      - http_proxy=${HTTP_PROXY}
      - https_proxy=${HTTP_PROXY}
    environment:
      - http_proxy=${HTTP_PROXY}
    volumes:
      - ./vpn-config:/etc/vpn-config
      - ./http-proxy-server:/etc/http-proxy-server
    ports:
      - "${PROXY_BIND_IP_PORT}:8080"
    tty: true
    devices:
      - "/dev/net/tun"
    cap_add:
      - NET_ADMIN
    restart: always

  pop3_proxy:
    build:
      context: ./pop3-proxy
      args:
      - http_proxy=${HTTP_PROXY}
      - https_proxy=${HTTP_PROXY}
    environment:
      - pop3_proxy_target=${POP3_PROXY_TARGET}
    links:
      - vpn:vpn_http_proxy
    ports:
      - "${POP3_BIND_IP_PORT}:110"
    tty: true
    restart: always
